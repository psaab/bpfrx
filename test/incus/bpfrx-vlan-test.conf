/* VLAN trunk test configuration.
 * A single physical interface (enp6s0) carries two VLANs:
 *   - unit 0 (native/untagged): trust zone, 10.0.1.1/24
 *   - unit 100 (vlan-id 100):   dmz zone, 10.0.100.1/24
 * A second interface (enp7s0) is untrust zone as usual.
 */

interfaces {
    enp6s0 {
        vlan-tagging;
        unit 0 {
            family inet { address 10.0.1.1/24; }
        }
        unit 100 {
            vlan-id 100;
            family inet { address 10.0.100.1/24; }
        }
    }
    enp7s0 {
        unit 0 {
            family inet { address 10.0.2.1/24; }
        }
    }
}

security {
    zones {
        security-zone trust {
            interfaces { enp6s0.0; }
            host-inbound-traffic {
                system-services { ssh; ping; }
            }
        }
        security-zone dmz {
            interfaces { enp6s0.100; }
            host-inbound-traffic {
                system-services { ssh; ping; }
            }
        }
        security-zone untrust {
            interfaces { enp7s0; }
            screen untrust-screen;
            host-inbound-traffic {
                system-services { ping; }
            }
        }
    }
    policies {
        default-policy deny-all;
        from-zone trust to-zone untrust {
            policy allow-all {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then { permit; log { session-init; session-close; } }
            }
        }
        from-zone trust to-zone dmz {
            policy allow-all {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then { permit; }
            }
        }
        from-zone untrust to-zone dmz {
            policy allow-web {
                match {
                    source-address any;
                    destination-address any;
                    application junos-http;
                }
                then { permit; }
            }
        }
    }
    nat {
        source {
            rule-set trust-to-untrust {
                from zone trust;
                to zone untrust;
                rule snat {
                    match { source-address 0.0.0.0/0; }
                    then { source-nat { interface; } }
                }
            }
        }
    }
    screen {
        ids-option untrust-screen {
            tcp { land; syn-flood; }
            icmp { ping-death; }
            ip { source-route-option; }
        }
    }
}
routing-options {
    static {
        route 0.0.0.0/0 { next-hop 10.0.2.1; }
    }
}
