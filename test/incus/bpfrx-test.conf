interfaces {
    enp6s0 {
        unit 0 {
            family inet {
                address 10.0.1.10/24;
            }
        }
    }
    enp7s0 {
        unit 0 {
            family inet {
                address 10.0.2.10/24;
            }
        }
    }
    enp8s0 {
        unit 0 {
            family inet {
                address 10.0.30.10/24;
            }
        }
    }
    enp9s0 {
        unit 0 {
            family inet {
                dhcp;
            }
        }
    }
    enp10s0 {
        unit 0 {
            family inet {
                dhcp;
            }
            family inet6 {
                dhcpv6;
            }
        }
    }
}
security {
    zones {
        security-zone trust {
            interfaces { enp6s0; }
            host-inbound-traffic {
                system-services { ssh; ping; }
            }
        }
        security-zone untrust {
            interfaces { enp7s0; }
            host-inbound-traffic {
                system-services { ping; }
            }
        }
        security-zone dmz {
            interfaces { enp8s0; }
            host-inbound-traffic {
                system-services { ssh; ping; }
            }
        }
        security-zone tunnel {
            interfaces { enp9s0; }
            host-inbound-traffic {
                system-services { ping; dhcp; }
            }
        }
        security-zone wan {
            interfaces { enp10s0; }
            host-inbound-traffic {
                system-services { ping; dhcp; dhcpv6; }
            }
        }
    }
    policies {
        default-policy deny-all;
        from-zone trust to-zone untrust {
            policy allow-all {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then { permit; log { session-init; session-close; } }
            }
        }
        from-zone trust to-zone dmz {
            policy allow-all {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then { permit; }
            }
        }
        from-zone untrust to-zone trust {
            policy allow-dnat-web {
                match {
                    source-address any;
                    destination-address any;
                    application junos-http;
                }
                then { permit; log { session-init; session-close; } }
            }
        }
        from-zone untrust to-zone dmz {
            policy allow-web {
                match {
                    source-address any;
                    destination-address any;
                    application junos-http;
                }
                then { permit; }
            }
        }
        from-zone trust to-zone wan {
            policy allow-all {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then { permit; log { session-init; } }
            }
        }
    }
    nat {
        source {
            rule-set trust-to-untrust {
                from zone trust;
                to zone untrust;
                rule snat {
                    match { source-address 0.0.0.0/0; }
                    then { source-nat { interface; } }
                }
            }
            rule-set trust-to-wan {
                from zone trust;
                to zone wan;
                rule snat {
                    match { source-address 0.0.0.0/0; }
                    then { source-nat { interface; } }
                }
            }
        }
        destination {
            pool web-server {
                address 10.0.1.100/32;
                port 80;
            }
            pool web-server-v6 {
                address fd00:1::100/128;
                port 80;
            }
            rule-set untrust-dnat {
                from zone untrust;
                rule web {
                    match {
                        destination-address 10.0.2.10/32;
                        destination-port 8080;
                    }
                    then { destination-nat pool web-server; }
                }
                rule web-v6 {
                    match {
                        destination-address fd00:2::10/128;
                        destination-port 8080;
                    }
                    then { destination-nat pool web-server-v6; }
                }
            }
        }
    }
    screen {
        ids-option untrust-screen {
            tcp { land; syn-flood; }
            icmp { ping-death; }
            ip { source-route-option; }
        }
    }
}
routing-options {
    static {
        route 10.0.30.0/24 { next-hop 10.0.30.1; }
        route 10.0.40.0/24 { next-hop 10.0.40.1; }
    }
}
